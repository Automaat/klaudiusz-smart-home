[tools]
actionlint = "1.7.11"
shellcheck = "0.11.0"
shellspec = "latest"
sops = "3.12.1"
uv = "0.10.7"

[tasks.check]
description = "Validate flake and check syntax"
run = "nix flake check"

[tasks.fmt]
description = "Format Nix files"
run = "nix fmt ."

[tasks.build-test]
description = "Test build homelab config without switching"
run = "nixos-rebuild build --flake .#homelab"

[tasks.update]
description = "Update flake.lock dependencies"
run = "nix flake update"

[tasks.decrypt-secrets]
description = "Decrypt secrets to temp file for editing"
run = "sops -d secrets/secrets.yaml > secrets/secrets.decrypted.yaml && chmod 600 secrets/secrets.decrypted.yaml && echo 'Decrypted to secrets/secrets.decrypted.yaml'"

[tasks.encrypt-secrets]
description = "Encrypt temp file back to secrets/secrets.yaml"
run = "if [ -f secrets/secrets.decrypted.yaml ]; then cp secrets/secrets.decrypted.yaml secrets/secrets.yaml && sops -e -i secrets/secrets.yaml && shred -u secrets/secrets.decrypted.yaml && echo 'Encrypted to secrets/secrets.yaml'; else echo 'No decrypted secrets file found at secrets/secrets.decrypted.yaml' >&2; exit 1; fi"

[tasks.test-scripts]
description = "Run shellspec tests for shell scripts"
run = "shellspec"
